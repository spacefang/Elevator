# æ™ºèƒ½ç”µæ¢¯è¿ç»´å¹³å° - æ ¸å¿ƒä¸šåŠ¡æµç¨‹è¯¦ç»†è®¾è®¡

> **ç‰ˆæœ¬**: v1.0  
> **æ›´æ–°æ—¥æœŸ**: 2025-01-06  
> **æ–‡æ¡£ç±»å‹**: ä¸šåŠ¡æµç¨‹è®¾è®¡  

---

## ç›®å½•

- [ä¸€ã€æ•°æ®é‡‡é›†ä¸ä¸ŠæŠ¥æµç¨‹](#ä¸€æ•°æ®é‡‡é›†ä¸ä¸ŠæŠ¥æµç¨‹)
- [äºŒã€å‘Šè­¦å¤„ç†æµç¨‹](#äºŒå‘Šè­¦å¤„ç†æµç¨‹)
- [ä¸‰ã€å·¥å•å¤„ç†å…¨æµç¨‹](#ä¸‰å·¥å•å¤„ç†å…¨æµç¨‹)
- [å››ã€å¤‡å“å¤‡ä»¶è°ƒæ‹¨æµç¨‹](#å››å¤‡å“å¤‡ä»¶è°ƒæ‹¨æµç¨‹)
- [äº”ã€ç»´ä¿æ‰§è¡Œæµç¨‹](#äº”ç»´ä¿æ‰§è¡Œæµç¨‹)
- [å…­ã€è·¨åŒºåè°ƒæµç¨‹](#å…­è·¨åŒºåè°ƒæµç¨‹)
- [ä¸ƒã€ä¸‰çº§æƒé™æ•°æ®æµè½¬](#ä¸ƒä¸‰çº§æƒé™æ•°æ®æµè½¬)
- [å…«ã€ç”¨æˆ·ç™»å½•ä¸æƒé™éªŒè¯](#å…«ç”¨æˆ·ç™»å½•ä¸æƒé™éªŒè¯)

---

## ä¸€ã€æ•°æ®é‡‡é›†ä¸ä¸ŠæŠ¥æµç¨‹

### 1.1 æµç¨‹æ¦‚è¿°

è®¾å¤‡æ•°æ®ä»è¾¹ç¼˜ç«¯é‡‡é›†ï¼Œé€šè¿‡ EMQX æ¶ˆæ¯é˜Ÿåˆ—ä¼ è¾“ã€‚åç«¯å¯¹æ•°æ®è¿›è¡Œè§£æä¸åˆ†ç±»ï¼š**å…¨é‡æ—¶åºæ•°æ®å†™å…¥ IoTDB**ï¼Œ**å‘Šè­¦/çŠ¶æ€å˜æ›´/ä¸šåŠ¡æ•°æ®å†™å…¥ PostgreSQL**ï¼Œ**æœ€æ–°çŠ¶æ€ä¸çƒ­æ•°æ®ç¼“å­˜è‡³ Redis**ï¼Œå¹¶é€šè¿‡ WebSocket/HTTP API åˆ†å‘åˆ°ä¸‰ç«¯ï¼ˆPC å¹³å°ã€å¤§å±ã€å°ç¨‹åºï¼‰è¿›è¡Œå±•ç¤ºã€‚

### 1.2 æµç¨‹å›¾

```mermaid
graph TB
    A[ç”µæ¢¯ä¼ æ„Ÿå™¨] -->|å®æ—¶é‡‡é›†| B[NeuronEX/IoTç½‘å…³]
    B -->|MQTTåè®®| C[EMQXæ¶ˆæ¯é˜Ÿåˆ—]
    
    C -->|è®¢é˜…ä¸»é¢˜| D[åç«¯æ•°æ®å¤„ç†å±‚]
    
    D -->|æ•°æ®è§£æ| E[è§„åˆ™å¼•æ“/æ•°æ®åˆ†ç±»]
    E -->|å…¨é‡æ—¶åºæ•°æ®| F[IoTDBæ—¶åºæ•°æ®åº“]
    E -->|å¼‚å¸¸æ•°æ®| G[å‘Šè­¦å¼•æ“]
    E -->|çŠ¶æ€å˜æ›´| S[çŠ¶æ€ç®¡ç†å™¨]
    
    G -->|å‘Šè­¦å…¥åº“| PG[PostgreSQL]
    S -->|çŠ¶æ€/äº‹ä»¶å…¥åº“| PG
    F -->|èšåˆç»Ÿè®¡ï¼ˆå®šæ—¶ï¼‰| T[ç»Ÿè®¡ä»»åŠ¡]
    T -->|å†™å…¥ç»Ÿè®¡| PG
    
    D -->|å®æ—¶æ¨é€| R[Redisç¼“å­˜]
    G -->|è§¦å‘å‘Šè­¦| I[å‘Šè­¦å¤„ç†æ¨¡å—]
    
    I -->|çº¢è‰²å‘Šè­¦| J[ä¸‰çº§åŒæ­¥æ¨é€]
    I -->|æ©™è‰²å‘Šè­¦| K[äºŒçº§æ¨é€]
    I -->|é»„è‰²å‘Šè­¦| L[ä¸€çº§æ¨é€]
    
    J --> M[æ€»ä¸­å¿ƒç£åŠ]
    J --> N[çœä¸­å¿ƒç›‘æ§]
    J --> O[å¸‚ä¸­å¿ƒå¤„ç†]
    
    K --> N
    K --> O
    
    L --> O
    
    R -->|WebSocket| P[PCç«¯å¹³å°]
    R -->|WebSocket| Q[å¯è§†åŒ–å¤§å±]
    R -->|WebSocket| X[ç§»åŠ¨å°ç¨‹åº]
    
    style G fill:#ff6b6b
    style J fill:#ff6b6b
    style K fill:#ffa500
    style L fill:#ffd700
    style F fill:#4CAF50
    style PG fill:#2196F3
    style R fill:#FF9800
```

### 1.3 æ•°æ®æ ¼å¼ç¤ºä¾‹

#### è®¾å¤‡ä¸ŠæŠ¥æ•°æ®ï¼ˆMQTT Topicï¼‰

```json
{
  "topic": "elevator/E1001/data",
  "payload": {
    "device_id": "E1001",
    "timestamp": 1704614400000,
    "floor": 12,
    "direction": "up",
    "door_status": "closed",
    "speed": 2.5,
    "load": 350,
    "temperature": 25,
    "vibration": 0.05,
    "power": 8.5
  }
}
```

#### å‘Šè­¦è§¦å‘æ•°æ®

```json
{
  "topic": "elevator/E1001/alert",
  "payload": {
    "device_id": "E1001",
    "alert_id": "ALT-20250106-001",
    "alert_level": "red",
    "alert_type": "trapped",
    "alert_desc": "å›°äººå‘Šè­¦",
    "timestamp": 1704614400000,
    "location": "å—å±±åŒºç§‘æŠ€å›­Aæ ‹ 6æ¥¼",
    "trapped_count": 6
  }
}
```

### 1.4 å…³é”®èŠ‚ç‚¹è¯´æ˜

| èŠ‚ç‚¹ | è¯´æ˜ | å¤„ç†æ—¶é—´ | æŠ€æœ¯å®ç° |
|------|------|---------|---------|
| **ä¼ æ„Ÿå™¨é‡‡é›†** | ç”µæ¢¯è¿è¡Œå‚æ•°å®æ—¶é‡‡é›† | å®æ—¶ï¼ˆ1ç§’/æ¬¡ï¼‰ | ç¡¬ä»¶ä¼ æ„Ÿå™¨ |
| **NeuronEX/IoTç½‘å…³** | æ•°æ®é¢„å¤„ç†ä¸åè®®è½¬æ¢ | <100ms | Edge Computing |
| **EMQXä¼ è¾“** | æ¶ˆæ¯é˜Ÿåˆ—ä¼ è¾“ | <50ms | MQTT QoS1 |
| **è§„åˆ™å¼•æ“** | æ•°æ®è§£æä¸å‘Šè­¦åˆ¤æ–­ | <100ms | å¤æ‚äº‹ä»¶å¤„ç†(CEP) |
| **æ•°æ®å­˜å‚¨** | åˆ†å±‚å­˜å‚¨ï¼šæ—¶åºâ†’IoTDBï¼›å‘Šè­¦/çŠ¶æ€/ä¸šåŠ¡â†’PostgreSQLï¼›çƒ­æ•°æ®â†’Redis | <50ms | IoTDB + PostgreSQL + Redis |
| **å‘Šè­¦æ¨é€** | å®æ—¶æ¨é€åˆ°ä¸‰ç«¯ | <200ms | WebSocket/æå…‰æ¨é€ |

### 1.5 å¼‚å¸¸å¤„ç†æœºåˆ¶

```mermaid
graph LR
    A[æ•°æ®ä¸ŠæŠ¥] -->|æˆåŠŸ| B[æ­£å¸¸æµç¨‹]
    A -->|å¤±è´¥| C{å¤±è´¥åŸå› }
    
    C -->|ç½‘ç»œä¸­æ–­| D[æœ¬åœ°ç¼“å­˜]
    C -->|æ•°æ®å¼‚å¸¸| E[æ•°æ®è¿‡æ»¤]
    C -->|è®¾å¤‡ç¦»çº¿| F[ç¦»çº¿æ ‡è®°]
    
    D -->|ç½‘ç»œæ¢å¤| G[æ‰¹é‡è¡¥ä¼ ]
    E --> H[ä¸¢å¼ƒæ•°æ®]
    F --> I[å‘Šè­¦é€šçŸ¥]
    
    G --> B
    
    style C fill:#ffa500
    style F fill:#ff6b6b
```

---

## äºŒã€å‘Šè­¦å¤„ç†æµç¨‹

### 2.1 å‘Šè­¦åˆ†çº§æ ‡å‡†

| çº§åˆ« | é¢œè‰² | æ¡ä»¶ | å“åº”æ—¶é—´ | å¤„ç†è§’è‰² |
|------|------|------|---------|---------|
| **çº¢è‰²** | ğŸ”´ | å›°äººã€å†²é¡¶ã€å æ¢¯ã€ç«ç¾ | 30åˆ†é’Ÿ | å¸‚ä¸­å¿ƒç«‹å³å“åº” |
| **æ©™è‰²** | ğŸŸ  | é—¨æ•…éšœã€åˆ¶åŠ¨å™¨å¼‚å¸¸ã€é’¢ä¸ç»³ç£¨æŸ | 2å°æ—¶ | å¸‚ä¸­å¿ƒè½¬å·¥å• |
| **é»„è‰²** | ğŸŸ¡ | æ¸©åº¦åé«˜ã€å™ªéŸ³å¼‚å¸¸ã€æŒ¯åŠ¨è¶…æ ‡ | 4å°æ—¶ | å¸‚ä¸­å¿ƒå·¡æ£€å¤„ç† |

### 2.2 çº¢è‰²å‘Šè­¦ï¼ˆå›°äººï¼‰å®Œæ•´æµç¨‹

```mermaid
sequenceDiagram
    participant D as è®¾å¤‡E1001
    participant E as EMQX
    participant B as åç«¯æœåŠ¡
    participant T as æ€»ä¸­å¿ƒ
    participant P as çœä¸­å¿ƒ
    participant C as å¸‚ä¸­å¿ƒ
    participant Tech as æŠ€æœ¯å‘˜å¼ å¸ˆå‚…
    
    Note over D: 14:30:00 è§¦å‘å›°äººä¼ æ„Ÿå™¨
    D->>E: å‘é€å›°äººå‘Šè­¦
    E->>B: æ¨é€å‘Šè­¦æ¶ˆæ¯
    B->>B: è§„åˆ™å¼•æ“åˆ¤å®šä¸ºçº¢è‰²å‘Šè­¦
    
    par ä¸‰çº§åŒæ­¥æ¨é€
        B->>T: æ¨é€ç£åŠé€šçŸ¥
        B->>P: æ¨é€ç›‘æ§é€šçŸ¥
        B->>C: æ¨é€å¤„ç†é€šçŸ¥
    end
    
    Note over C: 14:30:05 æ”¶åˆ°å‘Šè­¦
    C->>Tech: APPæ¨é€ç»™æŠ€æœ¯å‘˜
    
    Note over Tech: 14:31:00 æŸ¥çœ‹è¯¦æƒ…
    Tech->>C: ç¡®è®¤æ¥å•
    C->>B: æ›´æ–°å·¥å•çŠ¶æ€
    B->>P: é€šçŸ¥çœä¸­å¿ƒå·²æ¥å•
    
    Note over P: 14:32:00 å¯åŠ¨ç›‘æ§
    P->>P: ç›‘æ§30åˆ†é’Ÿæœªåˆ°åœºå‡çº§æœºåˆ¶
    
    Note over Tech: 14:45:00 åˆ°è¾¾ç°åœº
    Tech->>C: GPSè‡ªåŠ¨æ‰“å¡
    C->>B: è®°å½•åˆ°è¾¾æ—¶é—´
    B->>P: é€šçŸ¥å·²åˆ°åœº
    
    Note over Tech: 14:48:00 æ•‘æ´æˆåŠŸ
    Tech->>C: ä¸Šä¼ ç°åœºç…§ç‰‡
    Tech->>C: 6äººè„±å›°ç¡®è®¤
    C->>B: æäº¤å®Œæˆ
    
    B->>P: åˆ›å»ºåç»­ç»´ä¿®å·¥å•
    B->>T: é€šçŸ¥ç£åŠå®Œæˆ
    
    Note over T: 14:51:00 ç¡®è®¤å¤„ç†å®Œæˆ
    T->>B: è§£é™¤ç£åŠ
    B->>B: å…³é—­å‘Šè­¦
    B->>B: æ•°æ®å½’æ¡£
```

### 2.3 æ©™è‰²å‘Šè­¦ï¼ˆé—¨æ•…éšœï¼‰æµç¨‹

```mermaid
graph TB
    A[è®¾å¤‡E1008é—¨ç³»ç»Ÿå¼‚å¸¸] -->|10:15:00| B[è§¦å‘æ©™è‰²å‘Šè­¦]
    B --> C[æ¨é€å¸‚ä¸­å¿ƒ+çœä¸­å¿ƒ]
    C --> D[å¸‚ä¸­å¿ƒæ“ä½œå‘˜æŸ¥çœ‹]
    
    D -->|10:20:00| E{åˆ¤æ–­æ˜¯å¦éœ€è¦ç»´ä¿®}
    E -->|æ˜¯| F[åˆ›å»ºå·¥å•WO-002]
    E -->|å¦| G[è®°å½•å·¡æ£€/å¿½ç•¥]
    
    F --> H[æ™ºèƒ½æ´¾å•]
    H --> I[åˆ†é…æŠ€æœ¯å‘˜]
    
    I -->|11:30:00| J[æŠ€æœ¯å‘˜åˆ°è¾¾ç»´ä¿®]
    J --> K[æ›´æ¢é—¨é”]
    K --> L[æµ‹è¯•æ­£å¸¸]
    
    L -->|12:00:00| M[æäº¤å®Œæˆ]
    M --> N[ä¸»ç®¡éªŒæ”¶]
    N --> O[å·¥å•å…³é—­]
    O --> P[å‘Šè­¦å…³é—­]
    
    P --> Q[çœä¸­å¿ƒç»Ÿè®¡æœ¬æœˆé—¨æ•…éšœè¶‹åŠ¿]
    
    style B fill:#ffa500
    style E fill:#ffd700
```

### 2.4 é»„è‰²å‘Šè­¦ï¼ˆæ¸©åº¦å¼‚å¸¸ï¼‰æµç¨‹

```mermaid
graph LR
    A[è®¾å¤‡E1023æ¸©åº¦31Â°C] -->|08:00:00| B[è§¦å‘é»„è‰²å‘Šè­¦]
    B --> C[ä»…æ¨é€å¸‚ä¸­å¿ƒ]
    C --> D[å¸‚ä¸­å¿ƒæ‰¹é‡å¤„ç†]
    
    D -->|09:00:00| E[å®‰æ’ä¸‹åˆå·¡æ£€]
    E -->|14:00:00| F[æŠ€æœ¯å‘˜å·¡æ£€]
    F --> G[æ£€æŸ¥é€šé£ç³»ç»Ÿ]
    G --> H[æ¸…ç†æ•£çƒ­å£]
    
    H -->|14:30:00| I[æ¸©åº¦æ¢å¤æ­£å¸¸]
    I --> J[å‘Šè­¦å…³é—­]
    J --> K[è®°å½•ç»´ä¿æ—¥å¿—]
    
    style B fill:#ffd700
```

### 2.5 å‘Šè­¦å‡çº§æœºåˆ¶

```mermaid
graph TB
    A[å‘Šè­¦è§¦å‘] --> B{å‘Šè­¦çº§åˆ«}
    
    B -->|çº¢è‰²| C[å¸‚ä¸­å¿ƒå¤„ç†]
    B -->|æ©™è‰²| D[å¸‚ä¸­å¿ƒå¤„ç†]
    B -->|é»„è‰²| E[å¸‚ä¸­å¿ƒå¤„ç†]
    
    C -->|30åˆ†é’Ÿæœªå“åº”| F[è‡ªåŠ¨æ¨é€çœä¸­å¿ƒ]
    D -->|2å°æ—¶æœªå“åº”| G[æé†’å¸‚ä¸­å¿ƒ]
    E -->|4å°æ—¶æœªå“åº”| H[è‡ªåŠ¨è½¬å¾…åŠ]
    
    F -->|1å°æ—¶æœªä»‹å…¥| I[è‡ªåŠ¨æ¨é€æ€»ä¸­å¿ƒ]
    G -->|4å°æ—¶æœªå¤„ç†| J[æ¨é€çœä¸­å¿ƒ]
    
    I --> K[æ€»ä¸­å¿ƒå¼ºåˆ¶æŒ‡æ´¾ä¸“å®¶ç»„]
    J --> L[çœä¸­å¿ƒåè°ƒèµ„æºæ”¯æ´]
    
    style F fill:#ff6b6b
    style I fill:#ff0000
```

### 2.6 å‘Šè­¦ç»Ÿè®¡åˆ†æ

#### ç»Ÿè®¡ç»´åº¦

```mermaid
graph LR
    A[å‘Šè­¦æ•°æ®] --> B[æŒ‰çº§åˆ«ç»Ÿè®¡]
    A --> C[æŒ‰ç±»å‹ç»Ÿè®¡]
    A --> D[æŒ‰æ—¶æ®µç»Ÿè®¡]
    A --> E[æŒ‰åŒºåŸŸç»Ÿè®¡]
    
    B --> F[çº¢è‰²å‘Šè­¦è¶‹åŠ¿]
    B --> G[æ©™è‰²å‘Šè­¦è¶‹åŠ¿]
    B --> H[é»„è‰²å‘Šè­¦è¶‹åŠ¿]
    
    C --> I[å›°äººå‘Šè­¦åˆ†æ]
    C --> J[æ•…éšœå‘Šè­¦åˆ†æ]
    C --> K[å¼‚å¸¸å‘Šè­¦åˆ†æ]
    
    D --> L[é«˜å‘æ—¶æ®µè¯†åˆ«]
    E --> M[é«˜å‘åŒºåŸŸè¯†åˆ«]
    
    L --> N[ä¼˜åŒ–ç»´ä¿è®¡åˆ’]
    M --> N
```

---

## ä¸‰ã€å·¥å•å¤„ç†å…¨æµç¨‹

### 3.1 å·¥å•ç”Ÿå‘½å‘¨æœŸ

```mermaid
stateDiagram-v2
    [*] --> å¾…åˆ†é…: å·¥å•åˆ›å»º
    å¾…åˆ†é… --> å¾…æ¥å•: åˆ†é…æŠ€æœ¯å‘˜
    å¾…æ¥å• --> å¤„ç†ä¸­: æŠ€æœ¯å‘˜æ¥å•
    å¤„ç†ä¸­ --> å¾…éªŒæ”¶: æäº¤å®Œæˆ
    å¾…éªŒæ”¶ --> å·²å®Œæˆ: éªŒæ”¶é€šè¿‡
    å¾…éªŒæ”¶ --> å¤„ç†ä¸­: éªŒæ”¶ä¸é€šè¿‡(è¿”å·¥)
    å·²å®Œæˆ --> [*]: å·¥å•å…³é—­
    
    å¾…åˆ†é… --> å·²å–æ¶ˆ: å–æ¶ˆå·¥å•
    å¾…æ¥å• --> å·²å–æ¶ˆ: å–æ¶ˆå·¥å•
    å·²å–æ¶ˆ --> [*]
    
    å¤„ç†ä¸­ --> å·²æŒ‚èµ·: ç”³è¯·æ”¯æ´
    å·²æŒ‚èµ· --> å¤„ç†ä¸­: æ”¯æ´åˆ°ä½
```

### 3.2 å·¥å•åˆ›å»ºæµç¨‹

```mermaid
graph TB
    A[å·¥å•è§¦å‘æº] --> B{æ¥æºç±»å‹}
    
    B -->|å‘Šè­¦è‡ªåŠ¨| C[çº¢è‰²/æ©™è‰²å‘Šè­¦]
    B -->|çœä¸­å¿ƒåˆ›å»º| D[è·¨å¸‚è°ƒåº¦ä»»åŠ¡]
    B -->|å¸‚ä¸­å¿ƒåˆ›å»º| E[å®šæœŸç»´ä¿/å®¢æˆ·æŠ¥ä¿®]
    
    C --> F[è‡ªåŠ¨åˆ›å»ºç´§æ€¥å·¥å•]
    D --> G[çœä¸­å¿ƒå¡«å†™å·¥å•ä¿¡æ¯]
    E --> H[å¸‚ä¸­å¿ƒå¡«å†™å·¥å•ä¿¡æ¯]
    
    F --> I[å·¥å•åŸºæœ¬ä¿¡æ¯]
    G --> I
    H --> I
    
    I --> J[è®¾å¤‡ç¼–å·]
    I --> K[æ•…éšœæè¿°]
    I --> L[ä¼˜å…ˆçº§]
    I --> M[è¦æ±‚å®Œæˆæ—¶é—´]
    
    J --> N[ä¿å­˜å·¥å•]
    K --> N
    L --> N
    M --> N
    
    N --> O[è¿›å…¥å¾…åˆ†é…çŠ¶æ€]
    
    style C fill:#ff6b6b
    style F fill:#ff6b6b
```

### 3.3 æ™ºèƒ½æ´¾å•æµç¨‹

```mermaid
graph TB
    A[å¾…åˆ†é…å·¥å•WO-001] --> B[æ™ºèƒ½æ´¾å•ç®—æ³•]
    
    B --> C[åˆ†æå·¥å•ä¿¡æ¯]
    C --> D[è®¾å¤‡ä½ç½®: å—å±±åŒºç§‘æŠ€å›­]
    C --> E[æ‰€éœ€æŠ€èƒ½: å›°äººæ•‘æ´]
    C --> F[ä¼˜å…ˆçº§: ç´§æ€¥]
    
    B --> G[åŒ¹é…æŠ€æœ¯å‘˜]
    G --> H[è®¡ç®—è·ç¦»]
    G --> I[åŒ¹é…æŠ€èƒ½]
    G --> J[æ£€æŸ¥è´Ÿè½½]
    
    H --> K[æŠ€æœ¯å‘˜A: 2.3km]
    H --> L[æŠ€æœ¯å‘˜B: 5.8km]
    H --> M[æŠ€æœ¯å‘˜C: 8.1km]
    
    I --> N[æŠ€æœ¯å‘˜A: æœ‰å›°äººèµ„è´¨]
    I --> O[æŠ€æœ¯å‘˜B: æ— ]
    
    J --> P[æŠ€æœ¯å‘˜A: 1ä¸ªè¿›è¡Œä¸­]
    J --> Q[æŠ€æœ¯å‘˜B: 3ä¸ªè¿›è¡Œä¸­]
    
    K --> R[ç»¼åˆè¯„åˆ†]
    N --> R
    P --> R
    
    R --> S[æ¨èæŠ€æœ¯å‘˜A]
    S --> T{åˆ†é…æ–¹å¼}
    
    T -->|è‡ªåŠ¨åˆ†é…| U[ç›´æ¥åˆ†é…ç»™æŠ€æœ¯å‘˜A]
    T -->|æ‰‹åŠ¨åˆ†é…| V[è°ƒåº¦å‘˜ç¡®è®¤ååˆ†é…]
    
    U --> W[æ¨é€APPé€šçŸ¥]
    V --> W
    
    style S fill:#52c41a
```

### 3.4 å·¥å•æ‰§è¡Œæµç¨‹

```mermaid
sequenceDiagram
    participant W as å·¥å•ç³»ç»Ÿ
    participant A as æŠ€æœ¯å‘˜APP
    participant G as GPSå®šä½
    participant C as æ‘„åƒå¤´
    participant I as åº“å­˜ç³»ç»Ÿ
    
    Note over W: å·¥å•WO-001å·²åˆ†é…
    W->>A: æ¨é€å·¥å•é€šçŸ¥
    
    Note over A: æŠ€æœ¯å‘˜æŸ¥çœ‹è¯¦æƒ…
    A->>W: ç¡®è®¤æ¥å•
    W->>W: çŠ¶æ€: å¾…æ¥å•â†’å¤„ç†ä¸­
    
    Note over A: å¯¼èˆªè‡³ç°åœº
    A->>G: è¯·æ±‚GPSå®šä½
    G->>A: è¿”å›å½“å‰ä½ç½®
    
    Note over A: åˆ°è¾¾ç°åœº
    A->>W: GPSè‡ªåŠ¨æ‰“å¡
    W->>W: è®°å½•åˆ°è¾¾æ—¶é—´
    
    Note over A: æ‰«æè®¾å¤‡äºŒç»´ç 
    A->>W: ä¸Šä¼ è®¾å¤‡ID
    W->>W: æ ¸å¯¹è®¾å¤‡ä¿¡æ¯
    
    Note over A: å¼€å§‹ç»´ä¿®
    A->>C: æ‹æ‘„æ•…éšœç…§ç‰‡
    A->>A: æ‰§è¡Œç»´ä¿®æ“ä½œ
    A->>C: æ‹æ‘„ç»´ä¿®è¿‡ç¨‹
    
    Note over A: ä½¿ç”¨é…ä»¶
    A->>I: æ‰«æé…ä»¶æ¡ç 
    I->>A: è¿”å›é…ä»¶ä¿¡æ¯
    A->>I: ç™»è®°é¢†ç”¨æ•°é‡
    I->>I: è‡ªåŠ¨å‡ºåº“æ‰£å‡
    
    Note over A: å®Œæˆç»´ä¿®
    A->>C: æ‹æ‘„å®Œå·¥ç…§ç‰‡
    A->>W: å¡«å†™å¤„ç†è¯´æ˜
    A->>W: æäº¤å·¥å•
    
    W->>W: çŠ¶æ€: å¤„ç†ä¸­â†’å¾…éªŒæ”¶
    W->>W: é€šçŸ¥ä¸»ç®¡éªŒæ”¶
```

### 3.5 å·¥å•éªŒæ”¶æµç¨‹

```mermaid
graph TB
    A[å·¥å•æäº¤å®Œæˆ] --> B[å¸‚ä¸­å¿ƒä¸»ç®¡éªŒæ”¶]
    
    B --> C{æ£€æŸ¥å†…å®¹å®Œæ•´æ€§}
    C -->|å®Œæ•´| D[æ£€æŸ¥ç…§ç‰‡è´¨é‡]
    C -->|ä¸å®Œæ•´| E[é€€å›è¡¥å……ææ–™]
    
    D --> F{ç…§ç‰‡æ¸…æ™°åº¦}
    F -->|æ¸…æ™°| G[æ£€æŸ¥å¤„ç†è¯´æ˜]
    F -->|ä¸æ¸…æ™°| E
    
    G --> H{è¯´æ˜è¯¦ç»†åº¦}
    H -->|è¯¦ç»†| I[æ£€æŸ¥é…ä»¶ä½¿ç”¨]
    H -->|ä¸è¯¦ç»†| E
    
    I --> J{é…ä»¶ä½¿ç”¨åˆç†}
    J -->|åˆç†| K[éªŒæ”¶é€šè¿‡]
    J -->|ä¸åˆç†| E
    
    K --> L{æ˜¯å¦é‡å¤§å·¥å•}
    L -->|æ˜¯| M[æ¨é€çœä¸­å¿ƒæŠ½æ£€]
    L -->|å¦| N[ç›´æ¥å…³é—­å·¥å•]
    
    M --> O{çœä¸­å¿ƒæŠ½æ£€}
    O -->|é€šè¿‡| N
    O -->|ä¸é€šè¿‡| E
    
    E --> P[æŠ€æœ¯å‘˜æ”¶åˆ°é€€å›é€šçŸ¥]
    P --> Q[è¡¥å……ææ–™/è¿”å·¥]
    Q --> A
    
    N --> R[å·¥å•å…³é—­]
    R --> S[æ•°æ®å½’æ¡£]
    S --> T[å…³è”å‘Šè­¦å…³é—­]
    
    style K fill:#52c41a
    style E fill:#ff6b6b
```

### 3.6 å·¥å•ç»Ÿè®¡åˆ†æ

```mermaid
graph LR
    A[å·¥å•æ•°æ®] --> B[å¸‚ä¸­å¿ƒç»Ÿè®¡]
    A --> C[çœä¸­å¿ƒç»Ÿè®¡]
    A --> D[æ€»ä¸­å¿ƒç»Ÿè®¡]
    
    B --> E[æŠ€æœ¯å‘˜ç»©æ•ˆ]
    B --> F[å®ŒæˆåŠæ—¶ç‡]
    B --> G[éªŒæ”¶é€šè¿‡ç‡]
    
    C --> H[çœå†…ç§¯å‹ç›‘æ§]
    C --> I[å„å¸‚å¯¹æ¯”åˆ†æ]
    C --> J[èµ„æºé…ç½®ä¼˜åŒ–]
    
    D --> K[å…¨å›½å®Œæˆç‡æ’å]
    D --> L[å“åº”æ—¶é—´åˆ†æ]
    D --> M[ç»´ä¿æ•ˆç‡è¯„ä¼°]
```

---

## å››ã€å¤‡å“å¤‡ä»¶è°ƒæ‹¨æµç¨‹

### 4.1 ä¸‰çº§åº“å­˜æ¶æ„

```mermaid
graph TB
    A[æ€»ä»“-åŒ—äº¬] -->|æˆ˜ç•¥å‚¨å¤‡| B[é’¢ä¸ç»³: 5000æ ¹]
    A --> C[åˆ¶åŠ¨å™¨: 3000ä¸ª]
    A --> D[é—¨æœº: 2000å¥—]
    
    E[çœä»“-æ¹–åŒ—] -->|åŒºåŸŸè°ƒé…| F[é’¢ä¸ç»³: 500æ ¹]
    E --> G[åˆ¶åŠ¨å™¨: 300ä¸ª]
    
    H[å¸‚ä»“-æ­¦æ±‰] -->|å¿«é€Ÿå“åº”| I[é’¢ä¸ç»³: 50æ ¹]
    H --> J[åˆ¶åŠ¨å™¨: 30ä¸ª]
    
    A -.è·¨çœè°ƒæ‹¨.-> E
    E -.çœå†…è°ƒæ‹¨.-> H
    
    style A fill:#ff6b6b
    style E fill:#ffa500
    style H fill:#52c41a
```

### 4.2 ä½åº“å­˜è§¦å‘è°ƒæ‹¨æµç¨‹

```mermaid
sequenceDiagram
    participant MC as å¸‚ä»“ï¼ˆæ­¦æ±‰ï¼‰
    participant SYS as ç³»ç»Ÿ
    participant PC as çœä»“ï¼ˆæ¹–åŒ—ï¼‰
    participant NC as æ€»ä»“ï¼ˆåŒ—äº¬ï¼‰
    
    Note over MC: é’¢ä¸ç»³åº“å­˜: 12æ ¹
    MC->>SYS: ä½äºé˜ˆå€¼20æ ¹
    SYS->>SYS: è§¦å‘ä½åº“å­˜é¢„è­¦
    
    SYS->>MC: ç”Ÿæˆè¡¥è´§ç”³è¯·
    Note over MC: ç”³è¯·è°ƒæ‹¨30æ ¹
    MC->>SYS: æäº¤è°ƒæ‹¨ç”³è¯·
    
    SYS->>PC: æ¨é€è°ƒæ‹¨å®¡æ‰¹
    Note over PC: æŸ¥çœ‹çœä»“åº“å­˜: 85æ ¹
    PC->>PC: åº“å­˜å……è¶³ï¼Œå¯è°ƒæ‹¨
    
    PC->>SYS: å®¡æ‰¹é€šè¿‡
    SYS->>SYS: ç”Ÿæˆè°ƒæ‹¨å•å·: DB-20250106-001
    
    par åº“å­˜æ‰£å‡
        SYS->>PC: çœä»“æ‰£å‡30æ ¹
        PC->>PC: åº“å­˜: 85â†’55æ ¹
    end
    
    SYS->>SYS: ç”Ÿæˆç‰©æµå•
    Note over SYS: ç‰©æµå…¬å¸: é¡ºä¸°<br/>é¢„è®¡åˆ°è¾¾: 2å¤©
    
    SYS->>MC: æ¨é€ç‰©æµä¿¡æ¯
    
    Note over MC: 2å¤©åæ”¶åˆ°é…ä»¶
    MC->>SYS: æ‰«ç å…¥åº“
    
    par åº“å­˜å¢åŠ 
        SYS->>MC: å¸‚ä»“å¢åŠ 30æ ¹
        MC->>MC: åº“å­˜: 12â†’42æ ¹
    end
    
    SYS->>SYS: è°ƒæ‹¨å•å®Œæˆ
    SYS->>SYS: æ•°æ®å½’æ¡£
```

### 4.3 çœä»“åº“å­˜ä¸è¶³æ—¶çš„æµç¨‹

```mermaid
graph TB
    A[å¸‚ä»“ç”³è¯·è°ƒæ‹¨30æ ¹] --> B[çœä»“å®¡æ‰¹]
    B --> C{çœä»“åº“å­˜æ£€æŸ¥}
    
    C -->|åº“å­˜å……è¶³>=30æ ¹| D[å®¡æ‰¹é€šè¿‡]
    C -->|åº“å­˜ä¸è¶³<30æ ¹| E[å‘æ€»ä»“ç”³è¯·]
    
    D --> F[çœä»“â†’å¸‚ä»“è°ƒæ‹¨]
    
    E --> G[æäº¤æ€»ä»“å®¡æ‰¹]
    G --> H{æ€»ä»“å®¡æ‰¹}
    
    H -->|åŒæ„| I[æ€»ä»“â†’çœä»“è°ƒæ‹¨]
    H -->|æ‹’ç»| J[æ‹’ç»åŸå› è¯´æ˜]
    
    I --> K[çœä»“æ”¶è´§å…¥åº“]
    K --> F
    
    J --> L[å¸‚ä»“æ”¶åˆ°æ‹’ç»é€šçŸ¥]
    L --> M[å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆ]
    
    F --> N[å¸‚ä»“æ”¶è´§å…¥åº“]
    N --> O[è°ƒæ‹¨å®Œæˆ]
    
    style E fill:#ffa500
    style J fill:#ff6b6b
```

### 4.4 å·¥å•é…ä»¶å‡ºåº“æµç¨‹

```mermaid
sequenceDiagram
    participant T as æŠ€æœ¯å‘˜
    participant A as APP
    participant W as å·¥å•ç³»ç»Ÿ
    participant I as åº“å­˜ç³»ç»Ÿ
    participant WH as å¸‚ä»“
    
    Note over T: æ‰§è¡Œå·¥å•WO-001
    T->>A: éœ€è¦ä½¿ç”¨é…ä»¶
    
    A->>A: æ‰«æé…ä»¶æ¡ç 
    Note over A: é…ä»¶: é—¨é”-ç”µç£å‹<br/>ç¼–å·: PJ-001
    
    A->>I: æŸ¥è¯¢é…ä»¶ä¿¡æ¯
    I->>A: è¿”å›é…ä»¶è¯¦æƒ…
    
    A->>A: è¾“å…¥ä½¿ç”¨æ•°é‡: 1ä¸ª
    A->>W: å…³è”å·¥å•WO-001
    
    A->>I: æäº¤å‡ºåº“ç”³è¯·
    
    I->>I: æ£€æŸ¥åº“å­˜
    Note over I: å½“å‰åº“å­˜: 10ä¸ª<br/>å¯ç”¨åº“å­˜: 10ä¸ª
    
    I->>I: ç”Ÿæˆå‡ºåº“å•: OUT-20250106-001
    
    par åº“å­˜æ‰£å‡
        I->>WH: æ‰£å‡åº“å­˜1ä¸ª
        WH->>WH: åº“å­˜: 10â†’9ä¸ª
    end
    
    I->>A: å‡ºåº“æˆåŠŸ
    A->>T: æ˜¾ç¤ºå‡ºåº“å•å·
    
    Note over T: ç»´ä¿®å®Œæˆå
    T->>A: æäº¤å·¥å•
    A->>W: æ›´æ–°å·¥å•é…ä»¶æ¸…å•
    W->>I: åŒæ­¥é…ä»¶ä½¿ç”¨è®°å½•
```

### 4.5 ç›˜ç‚¹æµç¨‹

```mermaid
graph TB
    A[æœˆåº¦ç›˜ç‚¹è®¡åˆ’] --> B[åˆ›å»ºç›˜ç‚¹ä»»åŠ¡]
    B --> C[åˆ†é…ç›˜ç‚¹äººå‘˜]
    
    C --> D[å¼€å§‹ç›˜ç‚¹]
    D --> E[æ‰«ç ç›˜ç‚¹]
    D --> F[æ‰‹åŠ¨å½•å…¥]
    
    E --> G[ç³»ç»Ÿè®°å½•æ•°é‡]
    F --> G
    
    G --> H[å¯¹æ¯”è´¦é¢åº“å­˜]
    H --> I{æ˜¯å¦æœ‰å·®å¼‚}
    
    I -->|æ— å·®å¼‚| J[ç›˜ç‚¹æ­£å¸¸]
    I -->|æœ‰å·®å¼‚| K[æ ‡è®°å·®å¼‚]
    
    K --> L{å·®å¼‚ç±»å‹}
    L -->|ç›˜ç›ˆ| M[ç›˜ç›ˆå¤„ç†]
    L -->|ç›˜äº| N[ç›˜äºå¤„ç†]
    
    M --> O[å¡«å†™ç›˜ç›ˆåŸå› ]
    N --> P[å¡«å†™ç›˜äºåŸå› ]
    
    O --> Q[ä¸»ç®¡å®¡æ ¸]
    P --> Q
    
    Q --> R{å®¡æ ¸ç»“æœ}
    R -->|é€šè¿‡| S[è°ƒæ•´åº“å­˜]
    R -->|ä¸é€šè¿‡| T[é‡æ–°ç›˜ç‚¹]
    
    S --> U[ç”Ÿæˆç›˜ç‚¹æŠ¥å‘Š]
    J --> U
    
    U --> V[ç›˜ç‚¹å®Œæˆ]
    
    style K fill:#ffa500
    style N fill:#ff6b6b
```

---

## äº”ã€ç»´ä¿æ‰§è¡Œæµç¨‹

### 5.1 å®šæœŸç»´ä¿æµç¨‹

```mermaid
graph TB
    A[ç»´ä¿è®¡åˆ’ç”Ÿæˆ] --> B[ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºç»´ä¿å·¥å•]
    B --> C[æ ¹æ®ç»´ä¿å‘¨æœŸ]
    C --> D[è®¾å¤‡E1001: 15å¤©/æ¬¡]
    
    D --> E[ä¸Šæ¬¡ç»´ä¿: 2024-12-22]
    E --> F[è®¡ç®—ä¸‹æ¬¡ç»´ä¿: 2025-01-06]
    
    F --> G[æå‰3å¤©æé†’]
    G --> H[2025-01-03å‘é€æé†’]
    
    H --> I[å¸‚ä¸­å¿ƒè°ƒåº¦å‘˜]
    I --> J[å®‰æ’æŠ€æœ¯å‘˜]
    J --> K[åˆ›å»ºç»´ä¿å·¥å•]
    
    K --> L[æŠ€æœ¯å‘˜æ¥å•]
    L --> M[æŒ‰è®¡åˆ’ä¸Šé—¨]
    
    M --> N[æ‰§è¡Œç»´ä¿CheckList]
    N --> O[ä¸»æœºæ£€æŸ¥]
    N --> P[åˆ¶åŠ¨å™¨æ£€æŸ¥]
    N --> Q[é’¢ä¸ç»³æ£€æŸ¥]
    N --> R[é—¨ç³»ç»Ÿæ£€æŸ¥]
    N --> S[ç”µæ°”ç³»ç»Ÿæ£€æŸ¥]
    N --> T[å®‰å…¨è£…ç½®æ£€æŸ¥]
    
    O --> U[è®°å½•æ£€æŸ¥ç»“æœ]
    P --> U
    Q --> U
    R --> U
    S --> U
    T --> U
    
    U --> V[æ‹ç…§ç•™è¯]
    V --> W[å¡«å†™ç»´ä¿æŠ¥å‘Š]
    W --> X[æäº¤å®Œæˆ]
    
    X --> Y[ä¸»ç®¡éªŒæ”¶]
    Y --> Z[ç»´ä¿è®°å½•å½’æ¡£]
    Z --> AA[æ›´æ–°ä¸‹æ¬¡ç»´ä¿æ—¶é—´]
```

### 5.2 ç»´ä¿CheckList

```mermaid
graph LR
    A[ç»´ä¿CheckList] --> B[1. ä¸»æœºæ£€æŸ¥]
    A --> C[2. åˆ¶åŠ¨å™¨æ£€æŸ¥]
    A --> D[3. é’¢ä¸ç»³æ£€æŸ¥]
    A --> E[4. é—¨ç³»ç»Ÿæ£€æŸ¥]
    A --> F[5. ç”µæ°”ç³»ç»Ÿæ£€æŸ¥]
    A --> G[6. å®‰å…¨è£…ç½®æ£€æŸ¥]
    
    B --> B1[å¤–è§‚æ£€æŸ¥ âœ“]
    B --> B2[è¿è¡Œå£°éŸ³ âœ“]
    B --> B3[æ¸©åº¦æµ‹é‡ âœ“]
    
    C --> C1[åˆ¶åŠ¨é—´éš™ âœ“]
    C --> C2[åˆ¶åŠ¨åŠ›æµ‹è¯• âœ“]
    C --> C3[å¼¹ç°§çŠ¶æ€ âœ“]
    
    D --> D1[å¼ åŠ›æµ‹é‡ âœ“]
    D --> D2[ç£¨æŸæ£€æŸ¥ âœ“]
    D --> D3[æ¶¦æ»‘çŠ¶æ€ âœ“]
    
    E --> E1[é—¨æœºè¿è¡Œ âœ“]
    E --> E2[é—¨é”çŠ¶æ€ âœ“]
    E --> E3[å…‰å¹•æµ‹è¯• âœ“]
    
    F --> F1[æ¥è§¦å™¨æ£€æŸ¥ âœ“]
    F --> F2[çº¿è·¯æ£€æŸ¥ âœ“]
    F --> F3[æ¥åœ°æµ‹è¯• âœ“]
    
    G --> G1[é™é€Ÿå™¨æµ‹è¯• âœ“]
    G --> G2[å®‰å…¨é’³æ£€æŸ¥ âœ“]
    G --> G3[ç¼“å†²å™¨æ£€æŸ¥ âœ“]
```

### 5.3 æ•…éšœç»´ä¿æµç¨‹

```mermaid
sequenceDiagram
    participant A as å‘Šè­¦ç³»ç»Ÿ
    participant W as å·¥å•ç³»ç»Ÿ
    participant D as è°ƒåº¦å‘˜
    participant T as æŠ€æœ¯å‘˜
    participant I as åº“å­˜ç³»ç»Ÿ
    
    Note over A: è®¾å¤‡E1008é—¨æ•…éšœ
    A->>W: è‡ªåŠ¨åˆ›å»ºç´§æ€¥å·¥å•
    W->>W: å·¥å•WO-002<br/>ä¼˜å…ˆçº§: é‡è¦
    
    W->>D: æ¨é€å¾…åˆ†é…å·¥å•
    D->>D: æŸ¥çœ‹å·¥å•è¯¦æƒ…
    D->>D: æ™ºèƒ½æ´¾å•æ¨èæŠ€æœ¯å‘˜
    D->>W: åˆ†é…ç»™æŠ€æœ¯å‘˜B
    
    W->>T: APPæ¨é€å·¥å•
    T->>W: æ¥å•
    
    Note over T: å¯¼èˆªå‰å¾€
    T->>W: GPSæ‰“å¡åˆ°è¾¾
    
    T->>T: æ‰«ç ç­¾åˆ°
    T->>T: æ•…éšœè¯Šæ–­
    Note over T: é—¨é”æŸåéœ€æ›´æ¢
    
    T->>I: æ‰«ç é¢†ç”¨é—¨é”
    I->>I: å‡ºåº“æ‰£å‡åº“å­˜
    I->>T: å‡ºåº“æˆåŠŸ
    
    T->>T: æ›´æ¢é—¨é”
    T->>T: æµ‹è¯•é—¨å¼€å…³
    T->>T: æ‹ç…§è®°å½•
    
    T->>W: æäº¤å·¥å•
    Note over W: çŠ¶æ€: å¾…éªŒæ”¶
    
    W->>D: æ¨é€éªŒæ”¶é€šçŸ¥
    D->>W: æŸ¥çœ‹ç…§ç‰‡å’Œè¯´æ˜
    D->>W: éªŒæ”¶é€šè¿‡
    
    W->>W: å·¥å•å…³é—­
    W->>A: å…³è”å‘Šè­¦å…³é—­
```

---

## å…­ã€è·¨åŒºåè°ƒæµç¨‹

### 6.1 è·¨å¸‚æŠ€æœ¯æ”¯æ´æµç¨‹

```mermaid
graph TB
    A[æ­¦æ±‰å¸‚å‘ç”Ÿ4èµ·å›°äºº] --> B[å¸‚å†…3ä¸ªæŠ€æœ¯å‘˜å…¨éƒ¨å‡ºåŠ¨]
    B --> C[æ–°å¢ç¬¬4èµ·å›°äººå‘Šè­¦]
    
    C --> D[å¸‚ä¸­å¿ƒç³»ç»Ÿæ£€æµ‹]
    D --> E{æœ¬å¸‚æ˜¯å¦æœ‰å¯ç”¨èµ„æº}
    
    E -->|æ— | F[è‡ªåŠ¨ä¸ŠæŠ¥çœä¸­å¿ƒ]
    E -->|æœ‰| G[å¸‚å†…è°ƒåº¦]
    
    F --> H[çœä¸­å¿ƒè°ƒåº¦ç³»ç»Ÿ]
    H --> I[æŸ¥è¯¢ç›¸é‚»å¸‚èµ„æº]
    I --> J[æ´ªå±±åŒºæŠ€æœ¯å‘˜ç©ºé—²]
    
    J --> K[çœä¸­å¿ƒè°ƒåº¦å†³ç­–]
    K --> L[åè°ƒæ´ªå±±åŒºæŠ€æœ¯å‘˜æ”¯æ´]
    
    L --> M[æ¨é€è·¨åŒºå·¥å•]
    M --> N[æŠ€æœ¯å‘˜æ¥å•]
    N --> O[å¯¼èˆªè‡³æ­¦æ±‰ç°åœº]
    
    O --> P[æ‰§è¡Œæ•‘æ´]
    P --> Q[å·¥å•å®Œæˆ]
    
    Q --> R[è´¹ç”¨ç»“ç®—]
    R --> S[æ­¦æ±‰å¸‚ç»Ÿä¸€ç»“ç®—]
    
    S --> T[çœä¸­å¿ƒè®°å½•è°ƒåº¦]
    T --> U[çº³å…¥æœˆåº¦è€ƒæ ¸]
    
    style F fill:#ffa500
    style L fill:#52c41a
```

### 6.2 è·¨å¸‚é…ä»¶è°ƒæ‹¨æµç¨‹

```mermaid
sequenceDiagram
    participant W as æ­¦æ±‰å¸‚ä»“
    participant P as çœä¸­å¿ƒ
    participant Y as å®œæ˜Œå¸‚ä»“
    
    Note over W: æ€¥éœ€åˆ¶åŠ¨å™¨5ä¸ª<br/>æœ¬å¸‚åº“å­˜: 0ä¸ª
    W->>P: ç´§æ€¥ç”³è¯·è°ƒæ‹¨
    
    P->>P: æŸ¥è¯¢çœå†…å„å¸‚åº“å­˜
    Note over P: æ­¦æ±‰: 0ä¸ª<br/>å®œæ˜Œ: 15ä¸ª<br/>è¥„é˜³: 8ä¸ª
    
    P->>Y: æŸ¥è¯¢å®œæ˜Œå¯è°ƒæ‹¨æ•°é‡
    Y->>P: ç¡®è®¤å¯è°ƒæ‹¨5ä¸ª
    
    P->>P: å®¡æ‰¹é€šè¿‡
    P->>W: é€šçŸ¥ä»å®œæ˜Œè°ƒæ‹¨
    P->>Y: ä¸‹å‘è°ƒæ‹¨æŒ‡ä»¤
    
    Y->>Y: æ‰“åŒ…é…ä»¶
    Y->>Y: ç”Ÿæˆç‰©æµå•
    
    Note over Y: åŒåŸé€Ÿè¿<br/>é¢„è®¡6å°æ—¶åˆ°è¾¾
    
    Y->>P: ä¸Šä¼ ç‰©æµä¿¡æ¯
    P->>W: æ¨é€ç‰©æµè·Ÿè¸ª
    
    Note over W: 6å°æ—¶å
    W->>W: æ”¶è´§ç¡®è®¤
    W->>P: å…¥åº“å®Œæˆ
    
    P->>P: æ›´æ–°åŒæ–¹åº“å­˜
    P->>P: è´¹ç”¨ç»“ç®—
```

### 6.3 çœçº§ä¸“å®¶è°ƒåº¦æµç¨‹

```mermaid
graph TB
    A[æŸå¸‚å¤æ‚æ•…éšœ] --> B[å¸‚ä¸­å¿ƒæŠ€æœ¯å‘˜æ— æ³•å¤„ç†]
    B --> C[ç”³è¯·çœçº§ä¸“å®¶æ”¯æ´]
    
    C --> D[çœä¸­å¿ƒæ¥æ”¶ç”³è¯·]
    D --> E[æŸ¥çœ‹æ•…éšœæè¿°]
    E --> F{æ•…éšœå¤æ‚åº¦è¯„ä¼°}
    
    F -->|ä¸€èˆ¬| G[å®‰æ’çœå†…é«˜çº§æŠ€æœ¯å‘˜]
    F -->|å¤æ‚| H[ç”³è¯·æ€»ä¸­å¿ƒä¸“å®¶ç»„]
    
    G --> I[çœå†…ä¸“å®¶æ¥å•]
    I --> J[å‰å¾€ç°åœºæ”¯æ´]
    
    H --> K[æ€»ä¸­å¿ƒä¸“å®¶è¯„ä¼°]
    K --> L[æ´¾é£ä¸“å®¶ç»„]
    L --> M[æºå¸¦ä¸“ä¸šè®¾å¤‡]
    M --> J
    
    J --> N[ç°åœºè¯Šæ–­]
    N --> O[åˆ¶å®šæ–¹æ¡ˆ]
    O --> P[æŒ‡å¯¼ç»´ä¿®]
    
    P --> Q[æ•…éšœè§£å†³]
    Q --> R[æŠ€æœ¯æŠ¥å‘Š]
    R --> S[ç»éªŒæ€»ç»“]
    S --> T[çŸ¥è¯†åº“å½•å…¥]
    
    style H fill:#ff6b6b
    style L fill:#ff6b6b
```

---

## ä¸ƒã€ä¸‰çº§æƒé™æ•°æ®æµè½¬

### 7.1 æ•°æ®ä¸ŠæŠ¥æµç¨‹

```mermaid
graph TB
    A[å¸‚ç»´ä¿ä¸­å¿ƒ-æ­¦æ±‰] -->|å®æ—¶æ•°æ®| B[å¸‚çº§æ•°æ®åº“]
    B -->|æ±‡æ€»| C[çœè¿è¥ä¸­å¿ƒ-æ¹–åŒ—]
    C -->|æ±‡æ€»| D[æ€»æ•°æ®ä¸­å¿ƒ-åŒ—äº¬]
    
    B -->|å®æ—¶æ¨é€| E[å¸‚ä¸­å¿ƒå¹³å°]
    C -->|å®šæ—¶åŒæ­¥| F[çœä¸­å¿ƒå¹³å°]
    D -->|æ‰¹é‡æ±‡æ€»| G[æ€»ä¸­å¿ƒå¹³å°]
    
    E --> H[å¸‚ä¸­å¿ƒæ“ä½œå‘˜]
    F --> I[çœä¸­å¿ƒç®¡ç†å‘˜]
    G --> J[æ€»ä¸­å¿ƒå†³ç­–å±‚]
    
    H -->|å·¥å•æ•°æ®| K[æ—¥æŠ¥]
    I -->|ç»Ÿè®¡æ•°æ®| L[å‘¨æŠ¥/æœˆæŠ¥]
    J -->|åˆ†ææ•°æ®| M[å­£æŠ¥/å¹´æŠ¥]
    
    style A fill:#52c41a
    style C fill:#ffa500
    style D fill:#ff6b6b
```

### 7.2 æŒ‡ä»¤ä¸‹å‘æµç¨‹

```mermaid
graph TB
    A[æ€»æ•°æ®ä¸­å¿ƒå†³ç­–] --> B[å‘å¸ƒå…¨å›½æ”¿ç­–]
    B --> C[å‘Šè­¦é˜ˆå€¼è°ƒæ•´]
    B --> D[èŠ‚èƒ½ç›®æ ‡è®¾å®š]
    B --> E[è€ƒæ ¸æ ‡å‡†åˆ¶å®š]
    
    C --> F[çœä¸­å¿ƒæ¥æ”¶]
    D --> F
    E --> F
    
    F --> G[çœå†…æ‰§è¡Œæ–¹æ¡ˆ]
    G --> H[å¸‚ä¸­å¿ƒæ¥æ”¶]
    
    H --> I[å¸‚çº§å®æ–½ç»†åˆ™]
    I --> J[æŠ€æœ¯å‘˜æ‰§è¡Œ]
    
    J --> K[æ‰§è¡Œåé¦ˆ]
    K --> H
    H --> L[å¸‚çº§åé¦ˆ]
    L --> F
    F --> M[çœçº§æ€»ç»“]
    M --> A
    
    style A fill:#ff6b6b
    style F fill:#ffa500
    style H fill:#52c41a
```

### 7.3 æ•°æ®æŸ¥è¯¢æƒé™

```mermaid
graph LR
    A[ç”¨æˆ·ç™»å½•] --> B{è¯†åˆ«è§’è‰²}
    
    B -->|æ€»ä¸­å¿ƒ| C[æŸ¥è¯¢å…¨å›½æ•°æ®]
    B -->|çœä¸­å¿ƒ| D[æŸ¥è¯¢çœå†…æ•°æ®]
    B -->|å¸‚ä¸­å¿ƒ| E[æŸ¥è¯¢å¸‚å†…æ•°æ®]
    
    C --> F[WHERE 1=1]
    D --> G[WHERE province='æ¹–åŒ—']
    E --> H[WHERE province='æ¹–åŒ—' AND city='æ­¦æ±‰']
    
    F --> I[è¿”å›å…¨é‡ç»“æœ]
    G --> J[è¿”å›çœå†…ç»“æœ]
    H --> K[è¿”å›å¸‚å†…ç»“æœ]
```

---

## å…«ã€ç”¨æˆ·ç™»å½•ä¸æƒé™éªŒè¯

### 8.1 ç”¨æˆ·ç™»å½•æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant F as å‰ç«¯
    participant B as åç«¯
    participant DB as æ•°æ®åº“
    participant R as Redis
    
    U->>F: è¾“å…¥ç”¨æˆ·åå¯†ç 
    F->>F: å‰ç«¯éªŒè¯
    F->>B: POST /api/login
    
    B->>DB: æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
    DB->>B: è¿”å›ç”¨æˆ·æ•°æ®
    
    B->>B: éªŒè¯å¯†ç 
    alt å¯†ç æ­£ç¡®
        B->>B: ç”ŸæˆJWT Token
        B->>R: ç¼“å­˜ç”¨æˆ·ä¼šè¯
        B->>F: è¿”å›Token+ç”¨æˆ·ä¿¡æ¯
        F->>F: å­˜å‚¨Token
        F->>U: è·³è½¬åˆ°é¦–é¡µ
    else å¯†ç é”™è¯¯
        B->>F: è¿”å›é”™è¯¯ä¿¡æ¯
        F->>U: æ˜¾ç¤ºé”™è¯¯æç¤º
    end
```

### 8.2 æƒé™éªŒè¯æµç¨‹

```mermaid
graph TB
    A[ç”¨æˆ·è¯·æ±‚] --> B[å‰ç«¯æ‹¦æˆªå™¨]
    B --> C{æ˜¯å¦æœ‰Token}
    
    C -->|æ— | D[è·³è½¬ç™»å½•é¡µ]
    C -->|æœ‰| E[å‘é€è¯·æ±‚+Token]
    
    E --> F[åç«¯æ‹¦æˆªå™¨]
    F --> G{éªŒè¯Token}
    
    G -->|æ— æ•ˆ| H[è¿”å›401]
    G -->|æœ‰æ•ˆ| I[è§£æç”¨æˆ·ä¿¡æ¯]
    
    I --> J{æ£€æŸ¥åŠŸèƒ½æƒé™}
    J -->|æ— æƒé™| K[è¿”å›403]
    J -->|æœ‰æƒé™| L{æ£€æŸ¥æ•°æ®æƒé™}
    
    L -->|æ— æƒé™| K
    L -->|æœ‰æƒé™| M[æ‰§è¡Œä¸šåŠ¡é€»è¾‘]
    
    M --> N[æ·»åŠ æ•°æ®è¿‡æ»¤]
    N --> O[æ‰§è¡ŒSQLæŸ¥è¯¢]
    O --> P[è¿”å›ç»“æœ]
    
    H --> Q[å‰ç«¯è·³è½¬ç™»å½•]
    K --> R[å‰ç«¯æç¤ºæ— æƒé™]
    P --> S[å‰ç«¯æ¸²æŸ“æ•°æ®]
    
    style H fill:#ff6b6b
    style K fill:#ffa500
```

### 8.3 æ•°æ®æƒé™è¿‡æ»¤

```mermaid
graph TB
    A[ç”¨æˆ·è§’è‰²] --> B{è¯†åˆ«æ•°æ®èŒƒå›´}
    
    B -->|æ€»ä¸­å¿ƒç®¡ç†å‘˜| C[data_scope: national]
    B -->|çœä¸­å¿ƒç®¡ç†å‘˜| D[data_scope: province]
    B -->|å¸‚ä¸­å¿ƒæ“ä½œå‘˜| E[data_scope: city]
    
    C --> F[SQL: WHERE 1=1]
    D --> G[SQL: WHERE province = ?]
    E --> H[SQL: WHERE province = ? AND city = ?]
    
    F --> I[æŸ¥è¯¢å…¨å›½æ•°æ®]
    G --> J[æŸ¥è¯¢çœå†…æ•°æ®]
    H --> K[æŸ¥è¯¢å¸‚å†…æ•°æ®]
    
    I --> L[è¿”å›ç»“æœé›†]
    J --> L
    K --> L
```

---

## é™„å½•Aï¼šå…³é”®æ—¶æ•ˆæŒ‡æ ‡

| ä¸šåŠ¡ç±»å‹ | å“åº”æ—¶é—´ | åˆ°è¾¾æ—¶é—´ | å®Œæˆæ—¶é—´ | è¶…æ—¶å¤„ç† |
|---------|---------|---------|---------|---------|
| **çº¢è‰²å‘Šè­¦-å›°äºº** | 30åˆ†é’Ÿ | 60åˆ†é’Ÿ | 120åˆ†é’Ÿ | è‡ªåŠ¨å‡çº§çœä¸­å¿ƒ |
| **æ©™è‰²å‘Šè­¦-é—¨æ•…éšœ** | 120åˆ†é’Ÿ | 240åˆ†é’Ÿ | 480åˆ†é’Ÿ | 4å°æ—¶å‡çº§ |
| **é»„è‰²å‘Šè­¦-æ¸©åº¦å¼‚å¸¸** | 240åˆ†é’Ÿ | 480åˆ†é’Ÿ | 1440åˆ†é’Ÿ | 8å°æ—¶æé†’ |
| **å®šæœŸç»´ä¿** | æå‰3å¤© | æŒ‰è®¡åˆ’ | 2å°æ—¶ | å»¶æœŸéœ€å®¡æ‰¹ |
| **ç´§æ€¥å·¥å•** | 30åˆ†é’Ÿ | 60åˆ†é’Ÿ | 4å°æ—¶ | è‡ªåŠ¨å‡çº§ |
| **ä¸€èˆ¬å·¥å•** | 2å°æ—¶ | 4å°æ—¶ | 8å°æ—¶ | ç£åŠæé†’ |

## é™„å½•Bï¼šMQTTä¸»é¢˜è®¾è®¡

```
ç”µæ¢¯æ•°æ®ä¸»é¢˜ç»“æ„:
â”œâ”€â”€ elevator/{device_id}/data          # å®æ—¶è¿è¡Œæ•°æ®
â”œâ”€â”€ elevator/{device_id}/alert         # å‘Šè­¦æ¶ˆæ¯
â”œâ”€â”€ elevator/{device_id}/control       # è¿œç¨‹æ§åˆ¶æŒ‡ä»¤
â”œâ”€â”€ elevator/{device_id}/status        # çŠ¶æ€å˜æ›´
â””â”€â”€ elevator/{device_id}/heartbeat     # å¿ƒè·³åŒ…

è®¢é˜…è§„åˆ™:
â”œâ”€â”€ åç«¯æœåŠ¡: elevator/+/data          # è®¢é˜…æ‰€æœ‰è®¾å¤‡æ•°æ®
â”œâ”€â”€ åç«¯æœåŠ¡: elevator/+/alert         # è®¢é˜…æ‰€æœ‰è®¾å¤‡å‘Šè­¦
â””â”€â”€ å•è®¾å¤‡ç›‘æ§: elevator/E1001/#       # è®¢é˜…å•è®¾å¤‡æ‰€æœ‰ä¸»é¢˜
```

## é™„å½•Cï¼šæ•°æ®åº“è¡¨å…³è”å…³ç³»

```
æ ¸å¿ƒè¡¨å…³è”:
devices (è®¾å¤‡è¡¨)
â”œâ”€â”€ alerts (å‘Šè­¦è¡¨) - FK: device_id
â”œâ”€â”€ work_orders (å·¥å•è¡¨) - FK: device_id
â”œâ”€â”€ maintenance_records (ç»´ä¿è®°å½•è¡¨) - FK: device_id
â””â”€â”€ device_data (è®¾å¤‡æ•°æ®è¡¨) - FK: device_id

work_orders (å·¥å•è¡¨)
â”œâ”€â”€ work_order_logs (å·¥å•æ—¥å¿—è¡¨) - FK: work_order_id
â”œâ”€â”€ work_order_photos (å·¥å•ç…§ç‰‡è¡¨) - FK: work_order_id
â””â”€â”€ work_order_parts (å·¥å•é…ä»¶è¡¨) - FK: work_order_id

inventory (åº“å­˜è¡¨)
â”œâ”€â”€ inventory_in (å…¥åº“è¡¨) - FK: part_id
â”œâ”€â”€ inventory_out (å‡ºåº“è¡¨) - FK: part_id
â””â”€â”€ inventory_transfer (è°ƒæ‹¨è¡¨) - FK: part_id

users (ç”¨æˆ·è¡¨)
â”œâ”€â”€ roles (è§’è‰²è¡¨) - å¤šå¯¹å¤šå…³è”
â””â”€â”€ organizations (ç»„ç»‡è¡¨) - FK: org_id
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-01-06  
**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ  
**é€‚ç”¨èŒƒå›´**: å…¨å¹³å°ä¸šåŠ¡æµç¨‹

# 电梯运维平台 - 需求分析（v0.1）

> 本文基于 `docs/design/功能模块.md`、`docs/design/三级权限矩阵-监管与执行分离.md`、`docs/design/核心业务流程详细设计.md`、`docs/design/数据分层存储架构设计.md` 汇总而成，用于指导前后端并行开发与验收。

## 1. 背景与目标

### 1.1 背景

电梯运行数据实时产生且频率高，故障/困人等告警具有强时效要求；同时监管侧（国/省）需要宏观统计、督办与考核，执行侧（市/技术员）需要实时响应、工单闭环与证据留存。

### 1.2 项目目标

- 建立“采集 → 告警 → 工单 → 维保 → 备件 → 统计”闭环
- 落实三级权限：国/省侧监管督办、市侧执行处置，职责分离
- 实现稳定的实时展示（PC/大屏/小程序）与可追溯的数据沉淀

## 2. 角色与权限（业务约束）

> 权限原则：国/省重在监管统筹，市重在执行处置（见 `docs/design/三级权限矩阵-监管与执行分离.md`）。

### 2.1 主要角色

- 总中心（国）：监管督办、全局统计、供应链决策
- 省中心：区域监管、协调调度、工单审核/派发、库存调配
- 市中心：实时监控、告警处置、派单执行、现场验收
- 技术员：接单到场、维修/维保执行、拍照/资料上传、耗材登记

### 2.2 数据范围（典型约束）

- 国：全量
- 省：省内
- 市：市内
- 技术员：与本人工单/任务关联的数据为主

## 3. 业务范围与核心流程

### 3.1 核心业务流程（端到端）

1) 数据采集上报：NeuronEX/网关 → EMQX → 后端解析分类  
2) 告警处理：规则引擎判定级别 → 分级推送 → 市中心处置/转工单  
3) 工单闭环：派单 → 接单 → 到场 → 维修 → 验收 → 归档  
4) 备件流转：库存预警 → 申请/审批 → 出入库 → 关联工单  
5) 统计分析：从时序数据聚合 → 形成日报/周报/月报与考核指标

（流程细节见 `docs/design/核心业务流程详细设计.md`）

### 3.2 业务模块范围（按产品形态）

#### PC 运维管理平台（主战场）

以 `docs/design/功能模块.md` 为准，重点模块：
- 运维概览：地图、指标卡、趋势、待办
- 告警管理：告警列表/详情、确认/关闭、转工单、时效跟踪
- 设备管理：档案、状态监控、维保记录、视频/远程控制（受权限约束）
- 工单/维保：派单、执行、验收、资料归档
- 备品备件：库存、调拨、出入库、盘点、预警
- 数据分析/能耗：统计报表、排名对比、考核输出
- 系统管理：用户/角色/权限、组织区域、参数配置、审计

#### 可视化大屏驾驶舱

偏“态势感知 + 监管视角”，展示为主、操作为辅：
- 核心指标与趋势
- 告警态势（国仅红色、省橙+红、市全量）
- 地图与热力分布、排名对比

#### 移动端小程序/APP

偏“执行与闭环”：
- 技术员接单/到场打卡/执行记录/拍照上传
- 告警通知与处置入口
- 个人任务、工单列表、耗材登记

## 4. MVP（建议拆分与验收口径）

### 4.1 MVP-0（联调可跑）

- 登录与权限骨架（至少能区分国/省/市三类视角）
- 告警列表/详情（含分页、筛选基础能力）
- 工单最小闭环（创建/接单/完成/验收字段与状态流转）

### 4.2 MVP-1（业务闭环）

- MQTT 接入与数据入库：时序写 IoTDB、告警/状态写 PostgreSQL、最新状态写 Redis
- 告警分级推送（WebSocket/SSE）与 SLA 计时
- 维保执行与资料归档（照片/附件可先用对象存储占位）

## 5. 非功能需求（NFR）

### 5.1 性能与容量（方向性指标）

- 采集频率：秒级（按设备/点位扩展）
- 写入：高频写 IoTDB；PostgreSQL 仅承载告警/状态/业务
- 查询：实时页优先读 Redis/聚合结果，避免频繁扫 IoTDB 原始数据

### 5.2 可用性与可靠性

- 数据上报失败：边缘缓存 + 补传；后端幂等（去重/重放容忍）
- 告警推送：至少 WebSocket + 备用渠道（短信/推送服务）

### 5.3 安全与合规

- 身份认证：统一登录、token 失效与退出
- 授权：角色 + 数据范围过滤（国/省/市/技术员）
- 审计：关键操作（告警确认/关闭、工单状态变更、库存出入库）留痕

## 6. 开发协作约定（落地）

- 以 `docs/openapi.yaml` 作为前后端接口契约；变更先改契约再实现
- 以 `docs/协作进度.md` 作为日常推进与阻塞项汇总

